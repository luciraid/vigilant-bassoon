<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        function ChatApp() {
            const [messages, setMessages] = React.useState([]);
            const [input, setInput] = React.useState('');
            const [isListening, setIsListening] = React.useState(false);

            const sendMessage = async () => {
                if (input.trim() === '') return;

                const newMessages = [...messages, { text: input, sender: 'user' }];
                setMessages(newMessages);
                setInput('');

                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: input })
                });

                const data = await response.json();
                setMessages([...newMessages, { text: data.response, sender: 'bot' }]);
                speakText(data.response);
            };

            const handleVoiceInput = () => {
                setIsListening(true);
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setInput(transcript);
                    setIsListening(false);
                };

                recognition.start();
            };

            const speakText = (text) => {
                const utterance = new SpeechSynthesisUtterance(text);
                window.speechSynthesis.speak(utterance);
            };

            return (
                <div className="container mx-auto p-4">
                    <h1 className="text-3xl font-bold mb-4">AI Chatbot</h1>
                    <div className="bg-white rounded-lg shadow-md p-4 mb-4">
                        <div className="mb-4 h-64 overflow-y-auto">
                            {messages.map((message, index) => (
                                <div key={index} className={`mb-2 ${message.sender === 'user' ? 'text-right' : 'text-left'}`}>
                                    <span className={`inline-block p-2 rounded-lg ${message.sender === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}>
                                        {message.text}
                                    </span>
                                </div>
                            ))}
                        </div>
                        <div className="flex">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                className="flex-grow mr-2 p-2 border rounded"
                                placeholder="Type your message..."
                            />
                            <button onClick={sendMessage} className="bg-blue-500 text-white px-4 py-2 rounded">Send</button>
                        </div>
                    </div>
                    <button
                        onClick={handleVoiceInput}
                        className={`bg-green-500 text-white px-4 py-2 rounded ${isListening ? 'animate-pulse' : ''}`}
                    >
                        {isListening ? 'Listening...' : 'Voice Input'}
                    </button>
                </div>
            );
        }

        ReactDOM.render(<ChatApp />, document.getElementById('root'));
    </script>
</body>
</html>
